(function(){var t;(t=jQuery).fn.extend({chord:function(e){var n,r,i,o,a,s;return s={dataEndpoint:void 0,mainColor:"#777",depth:2,maxLabelLength:30,maxWordLength:5,debug:!1},s=t.extend(s,e),r=t(this),a=function(){return t.ajax({type:"GET",url:s.dataEndpoint,data:{depth:s.depth},success:function(t){return n(t)}})},n=function(t){var e,n,i,a,l,u,c,d,p,g,f,h,v,m,w,y,x,b,$,A,C,P,W,_,k,I;if(null==t.entities||t.entities.length<2)return r.hide(),void o("No data found for the chord.");for(P=function(t,e,n,r){return"translate("+t*n+","+e*r+")"},$=function(t){return"rotate("+t+")"},w=function(t){return t/(2*Math.PI)*360},function(t){return t>=0?1:-1},n=function(t){var e,n,r,i;for(t.length>s.maxLabelLength&&(t=t.substring(0,s.maxLabelLength)+"..."),n=[],i=e=0,r=(t=t.split(/\s/)).length-1;0<=r?e<=r:e>=r;i=0<=r?++e:--e)t[i].length>s.maxWordLength||i===t.length-1?n.push(t[i]):t[i+1]=t[i]+" "+t[i+1];return n},a=function(t,e){var n,r,i,o;for((t=String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0,o="#",n=void 0,r=void 0,r=i=0;i<=3;r=++i)n=parseInt(t.substr(2*r,2),16),o+=("00"+(n=Math.round(Math.min(Math.max(0,n+n*e),255)).toString(16))).substr(n.length);return o},u=function(e){var n,r,i;for(n=r=0,i=t.entities.length;0<=i?r<=i:r>=i;n=0<=i?++r:--r)if(t.entities[n].uri===e)return n;return-1},v=[],p=0,f=(y=t.entities).length;p<f;p++)y[p],v.push(function(){var e,n,r,i;for(i=[],e=0,n=(r=t.entities).length;e<n;e++)l=r[e],i.push(0);return i}());for(g=0,h=(x=t.relations).length;g<h;g++)b=x[g],k=u(b.s),I=u(b.o),v[k][I]=1,v[I][k]=1;return(W=d3.select("#"+r.attr("id")).append("svg")).attr("width","100%").attr("height","100%"),_=parseInt(W.style("width")),c=parseInt(W.style("height")),A=c<_?c:_,d=.2*A,m=.25*A,e=d3.svg.arc().innerRadius(d).outerRadius(m),i=d3.layout.chord().padding(.3).matrix(v),W.selectAll("chords").data(i.chords).enter().append("path").attr("class","relation").attr("d",d3.svg.chord().radius(d)).attr("transform",P(.5,.5,_,c)).style("opacity",.2).on("mouseover",function(){return d3.select(this).style("opacity",.8)}).on("mouseout",function(){return d3.select(this).style("opacity",.2)}),W.selectAll("arcs").data(i.groups).enter().append("path").attr("class",function(e){return"entity "+t.entities[e.index].css_class}).attr("d",e).attr("transform",P(.5,.5,_,c)).style("fill",function(e){var n,r;return n=s.mainColor,r=t.entities[e.index].type,"post"===r?n:"entity"===r?a(n,-.5):a(n,.5)}),W.selectAll("arcs_labels").data(i.groups).enter().append("text").attr("class","wl-chord-label").attr("font-size",function(){var t;return(t=parseInt(A/35))<8&&(t=8),t+"px"}).each(function(e){var r,i,o,a,s;for(o=n(t.entities[e.index].label),s=d3.select(this).attr("dy",o.length/3-.9*(o.length-1)+"em").text(o[0]),r=i=1,a=o.length;1<=a?i<=a:i>=a;r=1<=a?++i:--i)s.append("tspan").attr("x",0).attr("dy","1em").text(o[r]);return s.attr("transform",function(t){var e,n,r,i,o;return e=t.startAngle-Math.PI/2+Math.abs((t.endAngle-t.startAngle)/2),r=3,n=void 0,e>Math.PI/2?(n=e-Math.PI,r+=d3.select(this)[0][0].clientWidth):n=e,n=w(n),i=(m+r)/_,o=(m+r)/c,k=.5+i*Math.cos(e),I=.5+o*Math.sin(e),P(k,I,_,c)+$(n)}).attr("text-anchor",function(t){var e,n;return n=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,e=t.startAngle+Math.abs((t.endAngle-t.startAngle)/2),n&&e>Math.PI?"end":null})}),C=d3.select("body").append("div").attr("class","tooltip").style("background-color","white").style("color","black").style("opacity",0).style("position","absolute").style("z-index",100),W.selectAll(".entity, .label").on("mouseover",function(e){return d3.select(this).attr("cursor","pointer"),W.selectAll(".relation").filter(function(t,n){return t.source.index===e.index||t.target.index===e.index}).style("opacity",.8),C.text(t.entities[e.index].label).style("opacity",1)}).on("mouseout",function(t){return W.selectAll(".relation").filter(function(e,n){return e.source.index===t.index||e.target.index===t.index}).style("opacity",.2),C.style("opacity",0)}).on("mousemove",function(){return C.style("left",d3.event.pageX+"px").style("top",d3.event.pageY-30+"px")}).on("click",function(e){var n;return n=t.entities[e.index].url,window.location=n})},i=function(){return a()},o=function(t){if(s.debug)return"undefined"!=typeof console&&null!==console?console.log(t):void 0},i()}}),jQuery(function(t){return t(".wl-chord").each(function(){var e,n,r;return e=t(this),n=e.data(),t.extend(n,wl_chord_params),r=n.ajax_url+"?"+t.param({action:n.action,post_id:n.postId}),e.chord({dataEndpoint:r,depth:n.depth,mainColor:n.mainColor})})}),(t=jQuery).fn.extend({timeline:function(e){var n,r;return e=t.extend({dataEndpoint:null,settings:{}},e),r=t(this),n=function(t){if(null!=t.timeline)return new TL.Timeline(r.attr("id"),t.timeline,e.settings);r.hide()},function(){return t.ajax({type:"GET",url:e.dataEndpoint,success:function(t){return n(t)}})}()}}),jQuery(function(t){return t(".wl-timeline").each(function(){var e,n,r;return e=t(this),n=e.data(),t.extend(n,wl_timeline_params),r=n.ajax_url+"?"+t.param({action:n.action,post_id:n.postId,display_images_as:n.display_images_as,excerpt_length:n.excerpt_length}),t(this).timeline({dataEndpoint:r,settings:n.settings})})}),(t=jQuery).fn.extend({geomap:function(e){var n,r,i,o,a,s;return s={dataEndpoint:void 0,zoom:13,debug:!1},s=t.extend(s,e),r=t(this),i=function(){return a()},a=function(){return t.ajax({type:"GET",url:s.dataEndpoint,success:function(t){return n(t)}})},n=function(t){var e,n,i;return null==t.features||0===(null!=(n=t.features)?n.length:void 0)?(r.hide(),void o("Features missing: geomap cannot be rendered")):(e=L.map(r.attr("id")),1===(null!=(i=t.boundaries)?i.length:void 0)?e.setView(t.boundaries[0],s.zoom):e.fitBounds(L.latLngBounds(t.boundaries)),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(e),L.geoJson(t.features,{pointToLayer:function(t,e){return L.marker(e,{})},onEachFeature:function(t,e){var n;if(null!=(n=t.properties)?n.popupContent:void 0)return e.bindPopup(t.properties.popupContent)}}).addTo(e))},o=function(t){if(s.debug)return"undefined"!=typeof console&&null!==console?console.log(t):void 0},i()}}),jQuery(function(t){return t(".wl-geomap").each(function(){var e,n,r;return e=t(this),n=e.data(),t.extend(n,wl_geomap_params),r=n.ajax_url+"?"+t.param({action:n.action,post_id:n.postId}),e.geomap({dataEndpoint:r})})}),angular.module("wordlift.ui.carousel",["ngTouch"]).directive("wlCarousel",["$window","$log",function(t,e){return{restrict:"A",scope:!0,transclude:!0,template:'<div class="wl-carousel" ng-class="{ \'active\' : areControlsVisible }" ng-show="panes.length > 0" ng-mouseover="showControls()" ng-mouseleave="hideControls()">\n  <div class="wl-panes" ng-style="{ width: panesWidth, left: position }" ng-transclude ng-swipe-left="next()" ng-swipe-right="prev()" ></div>\n  <div class="wl-carousel-arrows" ng-show="areControlsVisible" ng-class="{ \'active\' : isActive() }">\n    <i class="wl-angle left" ng-click="prev()" ng-show="isPrevArrowVisible()" />\n    <i class="wl-angle right" ng-click="next()" ng-show="isNextArrowVisible()" />\n  </div>\n</div>',controller:["$scope","$element","$attrs","$log",function(e,n,r,i){var o,a;return a=angular.element(t),e.setItemWidth=function(){return n.width()/e.visibleElements()},e.showControls=function(){return e.areControlsVisible=!0},e.hideControls=function(){return e.areControlsVisible=!1},e.visibleElements=function(){return n.width()>460?4:1},e.isActive=function(){return e.isPrevArrowVisible()||e.isNextArrowVisible()},e.isPrevArrowVisible=function(){return e.currentPaneIndex>0},e.isNextArrowVisible=function(){return e.panes.length-e.currentPaneIndex>e.visibleElements()},e.next=function(){if(!(e.currentPaneIndex+e.visibleElements()+1>e.panes.length))return e.position=e.position-e.itemWidth,e.currentPaneIndex=e.currentPaneIndex+1},e.prev=function(){if(0!==e.currentPaneIndex)return e.position=e.position+e.itemWidth,e.currentPaneIndex=e.currentPaneIndex-1},e.setPanesWrapperWidth=function(){return e.panesWidth=e.panes.length*e.itemWidth,e.position=0,e.currentPaneIndex=0},e.itemWidth=e.setItemWidth(),e.panesWidth=void 0,e.panes=[],e.position=0,e.currentPaneIndex=0,e.areControlsVisible=!1,a.bind("resize",function(){var t,n,r;for(e.itemWidth=e.setItemWidth(),e.setPanesWrapperWidth(),t=0,n=(r=e.panes).length;t<n;t++)r[t].scope.setWidth(e.itemWidth);return e.$apply()}),o=this,o.registerPane=function(t,n,r){var i;return t.setWidth(e.itemWidth),i={scope:t,element:n},e.panes.push(i),e.setPanesWrapperWidth()},o.unregisterPane=function(t){var n,r,i,o,a;for(a=void 0,n=r=0,i=(o=e.panes).length;r<i;n=++r)o[n].scope.$id===t.$id&&(a=n);return e.panes.splice(a,1),e.setPanesWrapperWidth()}}]}}]).directive("wlCarouselPane",["$log",function(t){return{require:"^wlCarousel",restrict:"EA",scope:{wlFirstPane:"="},transclude:!0,template:"<div ng-transclude></div>",link:function(e,n,r,i){return n.addClass("wl-carousel-item"),e.isFirst=e.wlFirstPane||!1,e.setWidth=function(t){return n.css("width",t+"px")},e.$on("$destroy",function(){return t.debug("Destroy "+e.$id),i.unregisterPane(e)}),i.registerPane(e,n,e.isFirst)}}}]),angular.module("wordlift.utils.directives",[]).directive("wlOnError",["$parse","$window","$log",function(t,e,n){return{restrict:"A",compile:function(e,n){return function(e,r){var i;return i=t(n.wlOnError),r.on("error",function(t){var n;return n=function(){return i(e,{$event:t})},e.$apply(n)})}}}}]).directive("wlFallback",["$window","$log",function(t,e){return{restrict:"A",priority:99,link:function(t,n,r,i){return n.bind("error",function(){if(r.src!==r.wlFallback)return e.warn("Error on "+r.src+"! Going to fallback on "+r.wlFallback),r.$set("src",r.wlFallback)})}}}]).directive("wlHideAfter",["$timeout","$log",function(t,e){return{restrict:"A",link:function(n,r,i,o){var a;return a=+i.wlHideAfter,t(function(){return e.debug("Remove msg after "+a+" ms"),r.hide()},a)}}}]).directive("wlClipboard",["$timeout","$document","$log",function(t,e,n){return{restrict:"E",scope:{text:"=",onCopied:"&"},transclude:!0,template:'<span \n  class="wl-widget-post-link" \n  ng-class="{\'wl-widget-post-link-copied\' : $copied}"\n  ng-click="copyToClipboard()">\n  <ng-transclude></ng-transclude>\n  <input type="text" ng-value="text" />\n</span>',link:function(r,i,o,a){return r.$copied=!1,r.node=i.find("input"),r.node.css("position","absolute"),r.node.css("left","-10000px"),r.copyToClipboard=function(){var i;try{if(e[0].body.style.webkitUserSelect="initial",(i=e[0].getSelection()).removeAllRanges(),r.node.select(),e[0].execCommand("copy")||n.warn("Error on clipboard copy for "+text),i.removeAllRanges(),r.$copied=!0,t(function(){return n.debug("Going to reset $copied status"),r.$copied=!1},3e3),angular.isFunction(r.onCopied))return r.$evalAsync(r.onCopied())}finally{e[0].body.style.webkitUserSelect=""}}}}}]),t=jQuery,angular.module("wordlift.navigator.widget",["wordlift.ui.carousel","wordlift.utils.directives"]).provider("configuration",function(){var t;return t=void 0,{setConfiguration:function(e){return t=e},$get:function(){return t}}}).directive("wlNavigatorItems",["configuration","$window","$log",function(t,e,n){return{restrict:"E",scope:!0,template:function(e,n){var r,i,o,a,s;return s="wl-wrapper",a=" wl-carousel",i="wl-post wl-card wl-item-wrapper",r=" wl-carousel-pane",o="wl-card-image",t.attrs.with_carousel||(s="wl-floating-wrapper",a="",i="wl-post wl-card wl-floating-item-wrapper",r=""),t.attrs.squared_thumbs&&(o="wl-card-image wl-square"),'<div class="wl-posts">\n  <div class="'+s+'" '+a+'>\n    <div class="'+i+'" ng-repeat="item in items"'+r+'>\n      <div class="wl-card-header wl-entity-wrapper"> \n        <h6>\n          <a ng-href="{{item.entity.permalink}}">{{item.entity.label}}</a>\n        </h6>\n      </div>\n      <div class="'+o+'"> \n        <a ng-href="{{item.post.permalink}}" style="background: url({{item.post.thumbnail}}) no-repeat center center;background-size:cover;"></a>\n      </div>\n      <div class="wl-card-title"> \n        <a ng-href="{{item.post.permalink}}">{{item.post.title}}</a>\n      </div>\n    </div>\n  </div>\n</div>'}}}]).controller("NavigatorWidgetController",["DataRetrieverService","configuration","$scope","$log",function(t,e,n,r){return n.items=[],n.configuration=e,n.$on("itemsLoaded",function(t,e){return n.items=e})}]).service("DataRetrieverService",["configuration","$log","$http","$rootScope",function(t,e,n,r){var i;return i={},i.load=function(){var i;return i=t.ajax_url+"?action="+t.action+"&post_id="+t.post_id,e.debug("Going to load navigator items from "+i),n({method:"get",url:i}).success(function(t){return r.$broadcast("itemsLoaded",t)}).error(function(t,n){return e.warn("Error loading items, statut "+n)})},i}]).config(["configurationProvider",function(t){return t.setConfiguration(window.wl_navigator_params)}]),t(t('<div ng-controller="NavigatorWidgetController" ng-show="items.length > 0">\n      <h4 class="wl-headline">{{configuration.attrs.title}}</h4>\n      <wl-navigator-items></wl-navigator-items>\n    </div>').appendTo(".wl-navigator-widget"),0<t(".wl-navigator-widget").size()?angular.bootstrap(t(".wl-navigator-widget"),["wordlift.navigator.widget"]).invoke(["DataRetrieverService","$rootScope","$log",function(t,e,n){return e.$apply(function(){return t.load()})}]):void 0)}).call(this);