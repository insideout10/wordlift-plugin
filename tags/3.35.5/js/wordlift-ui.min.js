var $;($=jQuery).fn.extend({chord:function(t){var e,W,_,n,k;return k={dataEndpoint:void 0,mainColor:"#777",depth:2,maxLabelLength:30,maxWordLength:5,debug:!1},k=$.extend(k,t),W=$(this),n=function(){return $.ajax({type:"GET",url:k.dataEndpoint,data:{depth:k.depth},success:function(t){return e(t)}})},e=function(a){var t,s,e,r,n,l,i,o,u,c,d,p,g,f,h,v,m,w,y,x,b,$,A,C,P;if(null==a.entities||a.entities.length<2)return W.hide(),void _("No data found for the chord.");for(b=function(t,e,n,r){return"translate("+t*n+","+e*r+")"},w=function(t){return"rotate("+t+")"},f=function(t){return t/(2*Math.PI)*360},function(t){return 0<=t?1:-1},s=function(t){var e,n,r,i;for(t.length>k.maxLabelLength&&(t=t.substring(0,k.maxLabelLength)+"..."),n=[],i=e=0,r=(t=t.split(/\s/)).length-1;0<=r?e<=r:r<=e;i=0<=r?++e:--e)t[i].length>k.maxWordLength||i===t.length-1?n.push(t[i]):t[i+1]=t[i]+" "+t[i+1];return n},r=function(t,e){var n,r,i,o;for((t=String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0,o="#",r=n=void 0,r=i=0;i<=3;r=++i)n=parseInt(t.substr(2*r,2),16),o+=("00"+(n=Math.round(Math.min(Math.max(0,n+n*e),255)).toString(16))).substr(n.length);return o},n=function(t){var e,n,r;for(e=n=0,r=a.entities.length;0<=r?n<=r:r<=n;e=0<=r?++n:--n)if(a.entities[e].uri===t)return e;return-1},p=[],o=0,c=(h=a.entities).length;o<c;o++)h[o],p.push(function(){var t,e,n,r;for(r=[],t=0,e=(n=a.entities).length;t<e;t++)n[t],r.push(0);return r}());for(u=0,d=(v=a.relations).length;u<d;u++)m=v[u],C=n(m.s),P=n(m.o),p[C][P]=1,p[P][C]=1;return($=d3.select("#"+W.attr("id")).append("svg")).attr("width","100%").attr("height","100%"),A=parseInt($.style("width")),l=parseInt($.style("height")),i=.2*(y=l<A?l:A),g=.25*y,t=d3.svg.arc().innerRadius(i).outerRadius(g),e=d3.layout.chord().padding(.3).matrix(p),$.selectAll("chords").data(e.chords).enter().append("path").attr("class","relation").attr("d",d3.svg.chord().radius(i)).attr("transform",b(.5,.5,A,l)).style("opacity",.2).on("mouseover",function(){return d3.select(this).style("opacity",.8)}).on("mouseout",function(){return d3.select(this).style("opacity",.2)}),$.selectAll("arcs").data(e.groups).enter().append("path").attr("class",function(t){return"entity "+a.entities[t.index].css_class}).attr("d",t).attr("transform",b(.5,.5,A,l)).style("fill",function(t){var e,n;return e=k.mainColor,"post"===(n=a.entities[t.index].type)?e:r(e,"entity"===n?-.5:.5)}),$.selectAll("arcs_labels").data(e.groups).enter().append("text").attr("class","wl-chord-label").attr("font-size",function(){var t;return(t=parseInt(y/35))<8&&(t=8),t+"px"}).each(function(t){var e,n,r,i,o;for(r=s(a.entities[t.index].label),o=d3.select(this).attr("dy",r.length/3-.9*(r.length-1)+"em").text(r[0]),e=n=1,i=r.length;1<=i?n<=i:i<=n;e=1<=i?++n:--n)o.append("tspan").attr("x",0).attr("dy","1em").text(r[e]);return o.attr("transform",function(t){var e,n,r,i;return r=3,n=void 0,(e=t.startAngle-Math.PI/2+Math.abs((t.endAngle-t.startAngle)/2))>Math.PI/2?(n=e-Math.PI,r+=d3.select(this)[0][0].clientWidth):n=e,n=f(n),i=(g+r)/l,C=.5+(g+r)/A*Math.cos(e),P=.5+i*Math.sin(e),b(C,P,A,l)+w(n)}).attr("text-anchor",function(t){var e,n;return n=-1<navigator.userAgent.toLowerCase().indexOf("firefox"),e=t.startAngle+Math.abs((t.endAngle-t.startAngle)/2),n&&e>Math.PI?"end":null})}),x=d3.select("body").append("div").attr("class","tooltip").style("background-color","white").style("color","black").style("opacity",0).style("position","absolute").style("z-index",100),$.selectAll(".entity, .label").on("mouseover",function(n){return d3.select(this).attr("cursor","pointer"),$.selectAll(".relation").filter(function(t,e){return t.source.index===n.index||t.target.index===n.index}).style("opacity",.8),x.text(a.entities[n.index].label).style("opacity",1)}).on("mouseout",function(n){return $.selectAll(".relation").filter(function(t,e){return t.source.index===n.index||t.target.index===n.index}).style("opacity",.2),x.style("opacity",0)}).on("mousemove",function(){return x.style("left",d3.event.pageX+"px").style("top",d3.event.pageY-30+"px")}).on("click",function(t){var e;return e=a.entities[t.index].url,window.location=e})},_=function(t){if(k.debug)return"undefined"!=typeof console&&null!==console?console.log(t):void 0},function(){return n()}()}}),jQuery(function(r){return r(".wl-chord").each(function(){var t,e,n;return e=(t=r(this)).data(),r.extend(e,wl_chord_params),n=e.ajax_url+"?"+r.param({action:e.action,post_id:e.postId}),t.chord({dataEndpoint:n,depth:e.depth,mainColor:e.mainColor})})}),($=jQuery).fn.extend({timeline:function(e){var n,r;return e=$.extend({dataEndpoint:null,settings:{}},e),r=$(this),n=function(t){if(null!=t.timeline)return new TL.Timeline(r.attr("id"),t.timeline,e.settings);r.parent().hide()},function(){return $.ajax({type:"GET",url:e.dataEndpoint,success:function(t){return n(t)}})}()}}),jQuery(function(n){return n(".wl-timeline").each(function(){var t,e;return t=n(this).data(),n.extend(t,wl_timeline_params),e=t.ajax_url+"?"+n.param({action:t.action,post_id:t.postId,display_images_as:t.display_images_as,excerpt_length:t.excerpt_length}),n(this).timeline({dataEndpoint:e,settings:t.settings})})}),($=jQuery).fn.extend({geomap:function(t){var e,i,n,o,r,a;return a={dataEndpoint:void 0,zoom:13,debug:!1},a=$.extend(a,t),i=$(this),n=function(){return r()},r=function(){return $.ajax({type:"GET",url:a.dataEndpoint,success:function(t){return e(t)}})},e=function(t){var e,n,r;return null==t.features||0===(null!=(n=t.features)?n.length:void 0)?(i.hide(),void o("Features missing: geomap cannot be rendered")):(e=L.map(i.attr("id")),1===(null!=(r=t.boundaries)?r.length:void 0)?e.setView(t.boundaries[0],a.zoom):e.fitBounds(L.latLngBounds(t.boundaries)),L.tileLayer("https://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(e),L.geoJson(t.features,{pointToLayer:function(t,e){return L.marker(e,{})},onEachFeature:function(t,e){var n;if(null!=(n=t.properties)?n.popupContent:void 0)return e.bindPopup(t.properties.popupContent)}}).addTo(e))},o=function(t){if(a.debug)return"undefined"!=typeof console&&null!==console?console.log(t):void 0},n()}}),jQuery(function(r){return r(".wl-geomap").each(function(){var t,e,n;return e=(t=r(this)).data(),r.extend(e,wl_geomap_params),n=e.ajax_url+"?"+r.param({action:e.action,post_id:e.postId}),t.geomap({dataEndpoint:n})})}),angular.module("wordlift.ui.carousel",["ngTouch"]).directive("wlCarousel",["$window","$log",function(o,t){return{restrict:"A",scope:!0,transclude:!0,template:'<div class="wl-carousel" ng-class="{ \'active\' : areControlsVisible }" ng-show="panes.length > 0" ng-mouseover="showControls()" ng-mouseleave="hideControls()">\n  <div class="wl-panes" ng-style="{ width: panesWidth, left: position }" ng-transclude ng-swipe-left="next()" ng-swipe-right="prev()" ></div>\n  <div class="wl-carousel-arrows" ng-show="areControlsVisible" ng-class="{ \'active\' : isActive() }">\n    <i class="wl-angle left" ng-click="prev()" ng-show="isPrevArrowVisible()" />\n    <i class="wl-angle right" ng-click="next()" ng-show="isNextArrowVisible()" />\n  </div>\n</div>',controller:["$scope","$element","$attrs","$log",function(a,t,e,n){var r,i;return i=angular.element(o),a.setItemWidth=function(){return t.width()/a.visibleElements()},a.showControls=function(){return a.areControlsVisible=!0},a.hideControls=function(){return a.areControlsVisible=!1},a.visibleElements=function(){return 460<t.width()?4:1},a.isActive=function(){return a.isPrevArrowVisible()||a.isNextArrowVisible()},a.isPrevArrowVisible=function(){return 0<a.currentPaneIndex},a.isNextArrowVisible=function(){return a.panes.length-a.currentPaneIndex>a.visibleElements()},a.next=function(){if(!(a.currentPaneIndex+a.visibleElements()+1>a.panes.length))return a.position=a.position-a.itemWidth,a.currentPaneIndex=a.currentPaneIndex+1},a.prev=function(){if(0!==a.currentPaneIndex)return a.position=a.position+a.itemWidth,a.currentPaneIndex=a.currentPaneIndex-1},a.setPanesWrapperWidth=function(){return a.panesWidth=a.panes.length*a.itemWidth,a.position=0,a.currentPaneIndex=0},a.itemWidth=a.setItemWidth(),a.panesWidth=void 0,a.panes=[],a.position=0,a.currentPaneIndex=0,a.areControlsVisible=!1,r=function(){var t,e,n;for(a.itemWidth=a.setItemWidth(),a.setPanesWrapperWidth(),t=0,e=(n=a.panes).length;t<e;t++)n[t].scope.setWidth(a.itemWidth);return a.$apply()},i.bind("resize",function(){return r}),i.bind("load",function(){return r}),this.registerPane=function(t,e,n){var r;return t.setWidth(a.itemWidth),r={scope:t,element:e},a.panes.push(r),a.setPanesWrapperWidth()},this.unregisterPane=function(t){var e,n,r,i,o;for(o=void 0,e=n=0,r=(i=a.panes).length;n<r;e=++n)i[e].scope.$id===t.$id&&(o=e);return a.panes.splice(o,1),a.setPanesWrapperWidth()}}]}}]).directive("wlCarouselPane",["$log",function(i){return{require:"^wlCarousel",restrict:"EA",scope:{wlFirstPane:"="},transclude:!0,template:"<div ng-transclude></div>",link:function(t,e,n,r){return e.addClass("wl-carousel-item"),t.isFirst=t.wlFirstPane||!1,t.setWidth=function(t){return e.css("width",t+"px")},t.$on("$destroy",function(){return i.debug("Destroy "+t.$id),r.unregisterPane(t)}),r.registerPane(t,e,t.isFirst)}}}]),angular.module("wordlift.utils.directives",[]).directive("wlOnError",["$parse","$window","$log",function(i,t,e){return{restrict:"A",compile:function(t,e){return function(n,t){var r;return r=i(e.wlOnError),t.on("error",function(t){var e;return e=function(){return r(n,{$event:t})},n.$apply(e)})}}}}]).directive("wlFallback",["$window","$log",function(t,i){return{restrict:"A",priority:99,link:function(t,e,n,r){return e.bind("error",function(){if(n.src!==n.wlFallback)return i.warn("Error on "+n.src+"! Going to fallback on "+n.wlFallback),n.$set("src",n.wlFallback)})}}}]).directive("wlHideAfter",["$timeout","$log",function(o,a){return{restrict:"A",link:function(t,e,n,r){var i;return i=+n.wlHideAfter,o(function(){return a.debug("Remove msg after "+i+" ms"),e.hide()},i)}}}]).directive("wlClipboard",["$timeout","$document","$log",function(i,o,a){return{restrict:"E",scope:{text:"=",onCopied:"&"},transclude:!0,template:'<span\n  class="wl-widget-post-link"\n  ng-class="{\'wl-widget-post-link-copied\' : $copied}"\n  ng-click="copyToClipboard()">\n  <ng-transclude></ng-transclude>\n  <input type="text" ng-value="text" />\n</span>',link:function(e,t,n,r){return e.$copied=!1,e.node=t.find("input"),e.node.css("position","absolute"),e.node.css("left","-10000px"),e.copyToClipboard=function(){var t;try{if(o[0].body.style.webkitUserSelect="initial",(t=o[0].getSelection()).removeAllRanges(),e.node.select(),o[0].execCommand("copy")||a.warn("Error on clipboard copy for "+text),t.removeAllRanges(),e.$copied=!0,i(function(){return a.debug("Going to reset $copied status"),e.$copied=!1},3e3),angular.isFunction(e.onCopied))return e.$evalAsync(e.onCopied())}finally{o[0].body.style.webkitUserSelect=""}}}}}]),angular.module("wordlift.navigator.widget",["wordlift.ui.carousel","wordlift.utils.directives"]).provider("configuration",function(){var e;return e=void 0,{setConfiguration:function(t){return e=t},$get:function(){return e}}}).directive("wlNavigatorItems",["configuration","$window","$log",function(s,t,e){return{restrict:"E",scope:!0,template:function(t,e){var n,r,i,o,a;return a="wl-wrapper",o=" wl-carousel",r="wl-post wl-card wl-item-wrapper",n=" wl-carousel-pane",i="wl-card-image",s.attrs.with_carousel||(a="wl-floating-wrapper",r="wl-post wl-card wl-floating-item-wrapper",n=o=""),s.attrs.squared_thumbs&&(i="wl-card-image wl-square"),'<div class="wl-posts">\n  <div class="'+a+'" '+o+'>\n    <div class="'+r+'" ng-repeat="item in items"'+n+'>\n      <div class="wl-card-header wl-entity-wrapper"> \n        <h6>\n          <a ng-href="{{item.entity.permalink}}">{{item.entity.label}}</a>\n        </h6>\n      </div>\n      <div class="'+i+'"> \n        <a ng-href="{{item.post.permalink}}" style="background: url({{item.post.thumbnail}}) no-repeat center center;background-size:cover;"></a>\n      </div>\n      <div class="wl-card-title"> \n        <a ng-href="{{item.post.permalink}}">{{item.post.title}}</a>\n      </div>\n    </div>\n  </div>\n</div>'}}}]).controller("NavigatorWidgetController",["DataRetrieverService","configuration","$scope","$log",function(t,e,n,r){return n.items=[],n.configuration=e,n.$on("itemsLoaded",function(t,e){return n.items=e})}]).service("DataRetrieverService",["configuration","$log","$http","$rootScope",function(e,n,r,i){return{load:function(){var t;return t=e.ajax_url+"?action="+e.action+"&post_id="+e.post_id,n.debug("Going to load navigator items from "+t),r({method:"get",url:t}).success(function(t){return i.$broadcast("itemsLoaded",t)}).error(function(t,e){return n.warn("Error loading items, statut "+e)})}}}]).config(["configurationProvider",function(t){return t.setConfiguration(window.wl_navigator_params)}]),jQuery(function(t){if(t('<div ng-controller="NavigatorWidgetController" ng-show="items.length > 0">\n  <h4 class="wl-headline">{{configuration.attrs.title}}</h4>\n  <wl-navigator-items></wl-navigator-items>\n</div>').appendTo(".wl-navigator-widget"),0<t(".wl-navigator-widget").length)return angular.bootstrap(t(".wl-navigator-widget"),["wordlift.navigator.widget"]).invoke(["DataRetrieverService","$rootScope","$log",function(t,e,n){return e.$apply(function(){return t.load()})}])});