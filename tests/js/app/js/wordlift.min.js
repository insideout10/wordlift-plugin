(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};F=function(){function a(a){this._html=a}var b;return a.prototype._htmlPositions=[],a.prototype._textPositions=[],a.prototype._html="",a.prototype._text="",b=function(a){var b;return b=document.createElement("textarea"),b.innerHTML=a,b.value},a.create=function(b){var c;return c=new a(b),c.parse(),c},a.prototype.parse=function(){var a,c,d,e,f,g,h,i,j,k;for(this._htmlPositions=[],this._textPositions=[],this._text="",h=/([^&<>]*)(&[^&;]*;|<[^>]*>)([^&<>]*)/gim,i=0,c=0;g=h.exec(this._html);)e=g[1],a=g[2],d=g[3],k=e+("</p>"===a.toLowerCase()?"\n\n":""),j=d,i+=k.length,/^&[^&;]*;$/gim.test(a)&&(i+=1),c+=e.length+a.length,this._htmlPositions.push(c),this._textPositions.push(i),i+=j.length,c+=d.length,f="",/^&[^&;]*;$/gim.test(a)&&(f=b(a)),this._text+=k+f+j;return""===this._text&&""!==this._html&&(this._text=new String(this._html)),0===this._textPositions.length||0!==this._textPositions[0]?(this._htmlPositions.unshift(0),this._textPositions.unshift(0)):void 0},a.prototype.text2html=function(a){var b,c,d,e,f;for(b=0,d=0,c=e=0,f=this._textPositions.length;(f>=0?f>e:e>f)&&!(a<this._textPositions[c]);c=f>=0?++e:--e)b=this._htmlPositions[c],d=this._textPositions[c];return b+a-d},a.prototype.html2text=function(a){var b,c,d,e,f;if(a<this._htmlPositions[0])return 0;for(b=0,d=0,c=e=0,f=this._htmlPositions.length;(f>=0?f>e:e>f)&&!(a<this._htmlPositions[c]);c=f>=0?++e:--e)b=this._htmlPositions[c],d=this._textPositions[c];return d+a-b},a.prototype.insertHtml=function(a,b){var c;return c=this.text2html(b.text),this._html=this._html.substring(0,c)+a+this._html.substring(c),this.parse()},a.prototype.getHtml=function(){return this._html},a.prototype.getText=function(){return this._text},a}(),window.Traslator=F,g="@context",v="@graph",G="@value",c="analysisReceived",d="configurationTypesLoaded",x="http://www.w3.org/2000/01/rdf-schema#",z=""+x+"label",y=""+x+"comment",r="freebase",s="http://rdf."+r+".com/",t=""+s+"ns/",u=""+t+"common.topic.description",B="http://schema.org/",C=""+B+"description",n="http://fise.iks-project.eu/ontology/",p=""+n+"EntityAnnotation",q=""+n+"TextAnnotation",o=""+n+"confidence",k="http://purl.org/dc/terms/",h="dbpedia",i="http://"+h+".org/",j="http://(\\w{2}\\.)?"+h+".org/",I="wordlift",H="http://www.w3.org/2003/01/geo/wgs84_pos#",m="content",D="textannotation",f="#content_ifr",A="running",w=".mce_wordlift, .mce-wordlift button",e="contenteditable",E=3,l=1,angular.module("wordlift.tinymce.plugin.config",[]),angular.module("wordlift.directives.wlEntityProps",[]).directive("wlEntityProps",function(){return{restrict:"E",scope:{textAnnotations:"="},template:'<div class="wl-entity-props" ng-repeat="textAnnotation in textAnnotations">\n  <div ng-repeat="ea in textAnnotation.entityAnnotations | filterObjectBy:\'selected\':true">\n    <div ng-repeat="(k, ps) in ea.entity.props">\n      <input ng-repeat="p in ps" name="wl_props[{{ea.entity.id}}][{{k}}][]" ng-value="p" type="text" />\n    </div>\n  </div>\n</div>'}}),angular.module("wordlift.tinymce.plugin.directives",["wordlift.directives.wlEntityProps","wordlift.tinymce.plugin.controllers"]).directive("wlEntities",function(){return{restrict:"E",scope:{textAnnotation:"=",onSelect:"&"},link:function(a){return a.select=function(b){var c,d,e;e=a.textAnnotation.entityAnnotations;for(d in e)c=e[d],c.selected=b.id===c.id&&!c.selected;return a.onSelect({textAnnotation:a.textAnnotation,entityAnnotation:b.selected?b:null})}},template:'<div>\n  <ul>\n    <li ng-repeat="entityAnnotation in textAnnotation.entityAnnotations | orderObjectBy:\'confidence\':true">\n      <wl-entity on-select="select(entityAnnotation)" entity-annotation="entityAnnotation"></wl-entity>\n    </li>\n  </ul>\n</div>'}}).directive("wlEntity",["$log","$compile",function(a,b){return{restrict:"E",scope:{entityAnnotation:"=",onSelect:"&"},link:function(a,c){var d,e,f;return a.entity=null!=(e=a.entityAnnotation)?e.entity:void 0,d='<div class="entity {{entityAnnotation.entity.css}}" ng-class="{selected: true==entityAnnotation.selected}" ng-click="onSelect()" ng-show="entity.label">\n  <div class="thumbnail" ng-show="entity.thumbnail" title="{{entity.id}}" ng-attr-style="background-image: url({{entity.thumbnail}})"></div>\n  <div class="thumbnail empty" ng-hide="entity.thumbnail" title="{{entity.id}}"></div>\n  <div class="confidence" ng-bind="entityAnnotation.confidence"></div>\n  <div class="label" ng-bind="entity.label"></div>\n  <div class="'+(null!=(f=a.entity)?f.css:void 0)+'-info url" entity="entity"></div>\n  <div class="type"></div>\n  <div class="source" ng-class="entity.source" ng-bind="entity.source"></div>     \n</div>',c.html(d).show(),b(c.contents())(a)}}}]).directive("wlEventInfo",["$interpolate",function(a){return{restrict:"C",scope:{entity:"="},link:function(b){var c,d,e,f,g;return b.startDate=null!=(c=b.entity)&&null!=(d=c.props["http://www.w3.org/2002/12/cal#dtstart"])?d[0]:void 0,b.endDate=null!=(e=b.entity)&&null!=(f=e.props["http://www.w3.org/2002/12/cal#dtend"])?f[0]:void 0,b.place=null!=(g=b.entity)?g.props["http://www.w3.org/2006/vcard/ns#locality"]:void 0,b.renderDate=function(){return b.startDate===b.endDate?b.startDate:a("{{startDate}} - {{endDate}}",!1,null,!0)(b)}},template:'<span class="place" ng-bind="place"></span> <span class="date" ng-bind="renderDate()" title="{{renderDate()}}"></span>'}}]).directive("wlEntityInputBoxes",function(){return{restrict:"E",scope:{textAnnotations:"="},template:"<div class=\"wl-entity-input-boxes\" ng-repeat=\"textAnnotation in textAnnotations\">\n  <div ng-repeat=\"entityAnnotation in textAnnotation.entityAnnotations | filterObjectBy:'selected':true\">\n\n    <input type='text' name='wl_entities[{{entityAnnotation.entity.id}}][uri]' value='{{entityAnnotation.entity.id}}'>\n    <input type='text' name='wl_entities[{{entityAnnotation.entity.id}}][label]' value='{{entityAnnotation.entity.label}}'>\n    <textarea name='wl_entities[{{entityAnnotation.entity.id}}][description]'>{{entityAnnotation.entity.description}}</textarea>\n\n    <input type='text' name='wl_entities[{{entityAnnotation.entity.id}}][main_type]' value='{{entityAnnotation.entity.type}}'>\n\n    <input ng-repeat=\"type in entityAnnotation.entity.types\" type='text'\n    	name='wl_entities[{{entityAnnotation.entity.id}}][type][]' value='{{type}}'>\n\n    <input ng-repeat=\"image in entityAnnotation.entity.thumbnails\" type='text'\n      name='wl_entities[{{entityAnnotation.entity.id}}][image][]' value='{{image}}'>\n    <input ng-repeat=\"sameAs in entityAnnotation.entity.sameAs\" type='text'\n      name='wl_entities[{{entityAnnotation.entity.id}}][sameas][]' value='{{sameAs}}'>\n\n    <input type='text' name='wl_entities[{{entityAnnotation.entity.id}}][latitude]' value='{{entityAnnotation.entity.latitude}}'>\n    <input type='text' name='wl_entities[{{entityAnnotation.entity.id}}][longitude]' value='{{entityAnnotation.entity.longitude}}'>\n\n  </div>\n</div>"}}).directive("autocomplete",["$compile","$q","$log",function(b,c){return{restrict:"A",scope:{source:"&",onSelect:"&"},link:function(d,e){var f;return f='<wl-entity on-select="select(entityAnnotation)" entity-annotation="entityAnnotation"></wl-entity>',e.autocomplete({source:function(a,b){var e;return e={$viewValue:a.term},c.when(d.source(e)).then(function(a){return b(a)})},minLength:3,open:function(){return d.$emit("autocompleteOpened")},close:function(){return d.$emit("autocompleteClosed")}}).data("ui-autocomplete")._renderItem=function(c,g){var h,i,j;return j=d.$new(),j.entityAnnotation=g,j.select=function(a){return a.confidence=1,angular.element(e).val(""),angular.element(c).hide(),d.$emit("autocompleteClosed"),d.onSelect({entityAnnotation:a})},d.$on("$destroy",function(){return j.$destroy()}),i=angular.element(f),h=b(i),a("<li>").append(i).appendTo(c),h(j)}}}}]),angular.module("LoggerService",["wordlift.tinymce.plugin.services.Helpers"]).service("LoggerService",["$log",function(a){var b,c;return c={},b=function(a){var b;switch(b=/function ([^(]*)/i.exec(a.toString())){case null:return"unknown";default:return""===b[1]?"anonymous":b[1]}},c.debug=function(c,d){var e,f,g;if(a.debug(""+b(arguments.callee.caller)+" - "+c),null!=d){g=[];for(e in d)f=d[e],g.push((a.debug("[ "+e+" :: "),a.debug(f),a.debug("]")));return g}},c}]),angular.module("AnalysisService",["wordlift.tinymce.plugin.services.EntityService","wordlift.tinymce.plugin.services.Helpers","LoggerService"]).service("AnalysisService",["EntityAnnotationService","EntityService","Helpers","LoggerService","TextAnnotationService","$filter","$http","$q","$rootScope","$log",function(a,b,e,f,h,i,j,l,m,n){var r;return r={_knownTypes:[],_entities:{},promise:void 0,isRunning:!1},r.addEntity=function(a){return this._entities[a.id]=a},r.setEntities=function(a){return this._entities=a},r.getEntities=function(){return this._entities},r.setKnownTypes=function(a){return this._knownTypes=a,m.$broadcast(d,a),this._knownTypes},r.getKnownTypes=function(){return this._knownTypes},r.abort=function(){return this.isRunning&&null!=this.promise?this.promise.resolve():void 0},r.addTextAnnotation=function(a,b){return a.textAnnotations[b.id]=b,a},r.createAnEmptyAnalysis=function(){return{language:"",entities:{},entityAnnotations:{},textAnnotations:{},languages:[]}},r.enhance=function(b,c,d){var e,f,g,h;if(f=a.find(c.entityAnnotations,{uri:d.entity.id}),0===f.length){b.entities[d.entity.id]=d.entity,h=c.entityAnnotations;for(g in h)e=h[g],e.selected=!1;return d.selected=!0,b.entityAnnotations[d.id]=d,c.entityAnnotations[d.id]=b.entityAnnotations[d.id],!0}return!1},r.preselect=function(c,d){var e,f,g,i,j,k,l,m;for(m=[],k=0,l=d.length;l>k;k++)if(e=d[k],j=h.findOrCreate(c.textAnnotations,e),i=a.find(j.entityAnnotations,{uri:e.uri}),0<i.length)m.push(i[0].selected=!0);else{if(g=b.find(c.entities,{uri:e.uri}),0===g.length&&(g=b.find(this._entities,{uri:e.uri})),0===g.length){n.warn("Missing entity in window.wordlift.entities collection!"),n.info(e);continue}c.entities[e.uri]=g[0],f=a.create({label:e.label,confidence:1,entity:c.entities[e.uri],relation:c.textAnnotations[j.id],selected:!0}),c.entityAnnotations[f.id]=f,m.push(j.entityAnnotations[f.id]=c.entityAnnotations[f.id])}return m},r.analyze=function(a,b){return null==b&&(b=!1),r.isRunning?void 0:(r.isRunning=!0,r.promise=l.defer(),j({method:"post",url:ajaxurl+"?action=wordlift_analyze",data:a,timeout:r.promise.promise}).success(function(a){return m.$broadcast(c,r.parse(a,b)),r.isRunning=!1}).error(function(a,b){return r.isRunning=!1,m.$broadcast(c,void 0),0!==b?m.$broadcast("error","An error occurred while requesting an analysis."):void 0}))},r.parse=function(c,d){var i,j,l,n,s,t,u,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O;if(null==d&&(d=!1),C=[],F={},x={},t={},n=function(a){return{code:e.get(""+k+"language",a,l),confidence:e.get(o,a,l),_item:a}},null==c[g]||null==c[v])return m.$broadcast("error","The analysis response is invalid. Please try again later."),!1;for(l=c[g],y=c[v],H=0,J=y.length;J>H;H++)A=y[H],z=A["@id"],G=A["@type"],s=e.get(""+k+"type",A,l),e.containsOrEquals(q,G,l)&&e.containsOrEquals(""+k+"LinguisticSystem",s,l)?C.push(n(A)):e.containsOrEquals(q,G,l)?F[z]=A:e.containsOrEquals(p,G,l)?x[z]=A:t[z]=A;C.sort(function(a,b){return a.confidence<b.confidence?-1:a.confidence>b.confidence?1:0}),B=C[0].code;for(z in t)A=t[z],t[z]=b.create(A,B,r._knownTypes,l);if(f.debug("AnalysisService : merge",{entity:u,entities:t}),d)for(z in t)u=t[z],b.merge(u,t);if(d){L=this._entities;for(z in L)u=L[z],b.merge(u,t)}for(z in F)A=F[z],F[z]=h.build(A,l);for(z in x)for(A=x[z],M=a.build(A,B,t,F,l),I=0,K=M.length;K>I;I++)w=M[I],x[w.id]=w;if(d)for(E in F){D=F[E],N=D.entityAnnotations;for(z in N){w=N[z],O=D.entityAnnotations;for(j in O)i=O[j],z!==j&&w.entity===i.entity&&delete D.entityAnnotations[j]}}return{language:B,entities:t,entityAnnotations:x,textAnnotations:F,languages:C}},r}]),angular.module("wordlift.tinymce.plugin.services.EditorService",["wordlift.tinymce.plugin.config","AnalysisService","LoggerService"]).service("EditorService",["AnalysisService","EntityService","EntityAnnotationService","LoggerService","TextAnnotationService","$rootScope","$log",function(b,d,g,h,i,j,k){var l,n,o;return l=function(){return tinyMCE.get(m)},n=function(a){var b,c,d,e;for(d=F.create(a),c=/<(\w+)[^>]*\sitemid="([^"]+)"[^>]*>([^<]+)<\/\1>/gim,e=[];b=c.exec(a);)e.push({start:d.html2text(b.index),end:d.html2text(b.index+b[0].length),uri:b[2],label:b[3]});return e},o={createTextAnnotationFromCurrentSelection:function(){var a,b,c,d,e,f,g,h;return b=l(),b.selection.isCollapsed()?void k.warn("Invalid selection! The text annotation cannot be created"):(d=""+b.selection.getSel(),e=i.create({text:d}),f='<span id="'+e.id+'" class="'+D+'">'+b.selection.getContent()+"</span>",b.selection.setContent(f),a=b.getContent({format:"html"}),h=F.create(a),c=a.indexOf(f),g=h.html2text(c),e.start=g,e.end=e.start+d.length,k.debug("New text annotation created!"),k.debug(e),j.$broadcast("textAnnotationAdded",e))},createDefaultAnalysis:function(){var a,e,f,h,m,o,p,q,r,s,t;for(f=l(),m=f.getContent({format:"raw"}),a=b.createAnEmptyAnalysis(),h=b.getEntities(),t=n(m),r=0,s=t.length;s>r;r++)o=t[r],p=d.find(h,{uri:o.uri}),p.length>0?(q=i.findOrCreate(a.textAnnotations,o),e=g.create({entity:p[0]}),b.enhance(a,q,e)):(k.warn("Missing entity in wordlift.entities collection matching text annotation "+o.uri),k.debug(o));return j.$broadcast(c,a),a},embedAnalysis:function(){return function(a){var c,d,e,f,h,i,j,k,m,o,p;for(c=l(),i=c.getContent({format:"raw"}),e=n(i),b.preselect(a,e);i.match(/<(\w+)[^>]*\sclass="textannotation[^"]*"[^>]*>([^<]+)<\/\1>/gim,"$2");)i=i.replace(/<(\w+)[^>]*\sclass="textannotation[^"]*"[^>]*>([^<]+)<\/\1>/gim,"$2");o=F.create(i),p=a.textAnnotations;for(m in p)k=p[m],0<Object.keys(k.entityAnnotations).length&&(d='<span id="'+m+'" class="'+D,h=g.find(k.entityAnnotations,{selected:!0}),0<h.length&&null!=h[0].entity&&(f=h[0].entity,d+=" highlight "+f.css+'" itemid="'+f.id),d+='">',o.insertHtml(d,{text:k.start}),o.insertHtml("</span>",{text:k.end}));return j=c.isDirty(),c.setContent(o.getHtml(),{format:"raw"}),c.isNotDirty=!j}}(this),analyze:function(c){return b.isRunning?b.abort():(a(w).addClass(A),l().getBody().setAttribute(e,!1),b.analyze(c,!0))},getWinPos:function(b){var c,d;return c=l(),d=c.dom.getPos(b),{top:a(f).offset().top-a("body").scrollTop()+d.y-a(c.getBody()).scrollTop(),left:a(f).offset().left-a("body").scrollLeft()+d.x-a(c.getBody()).scrollLeft()}}},j.$on("selectEntity",function(a,c){var d,e,f,g,h,i;return e=l().dom,g=c.ta.id,d=D,null!=c.ea?(f=c.ea.entity,d+=" highlight "+f.css,i="itemscope",h=f.id,b.addEntity(f)):(i=null,h=null),e.setAttrib(g,"class",d),e.setAttrib(g,"itemscope",i),e.setAttrib(g,"itemid",h)}),j.$on(c,function(b,c){return h.debug("EditorService : Analysis Event",{analysis:c}),null!=c&&null!=c.textAnnotations&&o.embedAnalysis(c),a(w).removeClass(A),l().getBody().setAttribute(e,!0)}),o}]),angular.module("wordlift.tinymce.plugin.services.EntityAnnotationService",[]).service("EntityAnnotationService",["EntityAnnotationConfidenceService","Helpers","LoggerService",function(a,b){var c;return c={},c.create=function(c){var d,e;return d={id:"uri:local-entity-annotation-"+b.uniqueId(32),label:"",confidence:a.getDefault(),entity:null,relation:null,selected:!1,_item:null},null!=c.entity&&null==c.entity.label&&(c.entity.label=c.label),e=b.merge(d,c),a.enhanceConfidenceFor(e),e},c.build=function(a,d,e,f,g){var h,i,j,l,m,p,q,r;if(j=b.get(""+n+"entity-reference",a,g),null==e[j])return[];for(h=[],m=b.get(""+k+"relation",a,g),m=angular.isArray(m)?m:[m],q=0,r=m.length;r>q;q++)l=m[q],p=f[l],i=c.create({id:b.get("@id",a,g),label:b.getLanguage(""+n+"entity-label",a,d,g),confidence:b.get(o,a,g),entity:e[j],relation:p,_item:a}),null!=p&&(p.entityAnnotations[i.id]=i),h.push(i);return h},c.find=function(a,b){var c,d;return null!=b.uri?function(){var e,f;f=[];for(d in a)c=a[d],(b.uri===c.entity.id||(e=b.uri,L.call(c.entity.sameAs,e)>=0))&&f.push(c);return f}():null!=b.selected?function(){var e;e=[];for(d in a)c=a[d],c.selected===b.selected&&e.push(c);return e}():void 0},c}]),angular.module("wordlift.tinymce.plugin.services.EntityAnnotationConfidenceService",[]).service("EntityAnnotationConfidenceService",["EntityService","Helpers","$log",function(a,b,c){var d;return d={_entities:{}},d.setEntities=function(a){return this._entities=a},d.getDefault=function(){return l},d.enhanceConfidenceFor=function(b){var d;return d=0,b.entity.sources.length>1&&(d+=.2),L.call(b.entity.sources,I)>=0&&(d+=.2),b.entity.source===I&&(d+=1),a.checkIfIsIncluded(this._entities,{uri:b.entity.id})===!0&&(d+=1),c.debug("Entity annotation "+b.id+" enhancement: going to add "+d+" to confidence "+b.confidence),b.confidence+=d,c.debug(b),b},d}]),angular.module("wordlift.tinymce.plugin.services.EntityService",["wordlift.tinymce.plugin.services.Helpers","LoggerService"]).service("EntityService",["Helpers","LoggerService","$filter",function(a,b,c){var d;return d={},d.find=function(a,b){var c,d;return null!=b.uri?function(){var e,f;f=[];for(d in a)c=a[d],(b.uri===(null!=c?c.id:void 0)||(e=b.uri,L.call(null!=c?c.sameAs:void 0,e)>=0))&&f.push(c);return f}():void 0},d.checkIfIsIncluded=function(a,b){return a=this.find(a,b),a.length>0?!0:!1},d.create=function(b,c,e,f){var g,i,k,l,m,n,o,p;return l=a.get("@id",b,f),p=a.get("@type",b,f,function(b){var c,d,e,g;for(b=angular.isArray(b)?b:[b],g=[],d=0,e=b.length;e>d;d++)c=b[d],g.push(a.expand(c,f));return g}),n=a.get("http://www.w3.org/2002/07/owl#sameAs",b,f),n=angular.isArray(n)?n:[n],k=function(a){var b,c,d,e,f;for(a=angular.isArray(a)?a:[a],f=[],d=0,e=a.length;e>d;d++)c=a[d],b=/m\.(.*)$/i.exec(c),f.push(null===b?c:"https://usercontent.googleapis.com/"+r+"/v1/image/m/"+b[1]+"?maxwidth=4096&maxheight=4096");return f},o=a.get(["http://xmlns.com/foaf/0.1/depiction",""+t+"common.topic.image",""+B+"image"],b,f,k),m=d.getKnownTypes(p,e,f),g=m[0].type.css,i={id:l,thumbnail:0<o.length?o[0]:null,thumbnails:o,css:g,type:m[0].type.uri,types:p,label:a.getLanguage(z,b,c,f),labels:a.get(z,b,f),sameAs:n,source:l.match("^"+s+".*$")?r:l.match("^"+j+".*$")?h:"wordlift",_item:b,props:d.createProps(b,f)},i.sources=[i.source],i.description=a.getLanguage([y,u,C],b,c,f),i.descriptions=a.get([y,u,C],b,f),null==i.description&&(i.description=""),i.latitude=a.get(""+H+"lat",b,f),i.longitude=a.get(""+H+"long",b,f),(0===i.latitude.length||0===i.longitude.length)&&(i.latitude="",i.longitude=""),i},d.merge=function(c,e){var f,g,i,j,k;for(k=c.sameAs,i=0,j=k.length;j>i;i++)g=k[i],null!=e[g]&&e[g]!==c&&(f=e[g],b.debug("EntityService.merge : found a match [ entity 1 :: "+c.id+" ][ entity 2 :: "+f.id+" ]"),a.mergeUnique(c.sameAs,f.sameAs),a.mergeUnique(c.thumbnails,f.thumbnails),a.mergeUnique(c.sources,f.sources),a.mergeUnique(c.types,f.types),null==c.css&&(c.css=f.css),c.source=c.sources.join(", "),h===f.source&&(c.description=f.description),h===f.source&&null!=f.longitude&&(c.longitude=f.longitude),h===f.source&&null!=f.latitude&&(c.latitude=f.latitude),e[g]=c,d.merge(c,e));return b.debug("EntityService.merge [ id :: "+c.id+" ]",{entity:c}),c},d.getKnownTypes=function(b,d,e){var f,g,h,i,j,k,l,m;for(i=[],f=void 0,l=0,m=d.length;m>l;l++)g=d[l],L.call(g.sameAs,"*")>=0&&(f=[{type:g}]),k=g.sameAs.concat(g.uri),h=function(){var c,d,f;for(f=[],c=0,d=k.length;d>c;c++)j=k[c],a.containsOrEquals(j,b,e)&&f.push(j);return f}(),0<h.length&&i.push({matches:h,type:g});return 0===i.length?f:(c("orderBy")(i,"matches",!0),i)},d.createProps=function(b,c){var d,e,f,g;f={};for(e in b)g=b[e],angular.isObject(g)||(d=a.expand(e,c),null==f[d]&&(f[d]=[]),f[d].push(a.expand(g,c)));return f},d}]),angular.module("wordlift.tinymce.plugin.services.Helpers",[]).service("Helpers",[function(){var a;return a={},a.merge=function(a,b){return this.extend(this.extend({},a),b)},a.extend=function(a,b){var c,d;for(c in b)d=b[c],a[c]=d;return a},a.uniqueId=function(a){var b;for(null==a&&(a=8),b="";b.length<a;)b+=Math.random().toString(36).substr(2);return b.substr(0,a)},a._expand=function(a,b){var c,d,e,f;if(null!=a)return null===(c=(""+a).match(/([\w|\d]+):(.*)/))?(e=a,d=""):(e=c[1],d=c[2]),null==b[e]?a:(f=angular.isString(b[e])?b[e]:b[e]["@id"],f+d)},a.expand=function(b,c){var d;return angular.isArray(b)?function(){var e,f,g;for(g=[],e=0,f=b.length;f>e;e++)d=b[e],g.push(a.expand(d,c));return g}():a._expand(b,c)},a.get=function(b,c,d,e){var f,g,h,i,j;if(!angular.isArray(b))return a.getA(b,c,d,e);for(h=[],i=0,j=b.length;j>i;i++)g=b[i],f=a.getA(g,c,d,e),f=angular.isArray(f)?f:[f],a.mergeUnique(h,f);return h},a.getA=function(b,c,d,e){var f,g,h;null==e&&(e=function(a){return a}),h=a.expand(b,d);for(f in c)if(g=c[f],h===a.expand(f,d))return e(g);return[]},a.getLanguage=function(b,c,d,e){var f,g,h,i,j,k;if(null!==(g=a.get(b,c,e))){for(g=angular.isArray(g)?g:[g],h=0,j=g.length;j>h;h++)if(f=g[h],d===f["@language"])return f[G];for(i=0,k=g.length;k>i;i++)if(f=g[i],"en"===f["@language"])return f[G]}},a.mergeUnique=function(a,b){var c,d,e,f;for(null==a&&(a=[]),f=[],d=0,e=b.length;e>d;d++)c=b[d],L.call(a,c)<0&&f.push(a.push(c));return f},a.containsOrEquals=function(b,c,d){var e,f,g,h,i;if(null==c)return!1;for(g=angular.isArray(c)?c:[c],f=a.expand(b,d),h=0,i=g.length;i>h;h++)if(e=g[h],f===a.expand(e,d))return!0;return!1},a}]),angular.module("wordlift.tinymce.plugin.services.TextAnnotationService",[]).service("TextAnnotationService",["Helpers",function(a){var b;return b={},b.create=function(b){var c;return null==b&&(b={}),c={id:"urn:local-text-annotation-"+a.uniqueId(32),text:"",start:0,end:0,confidence:0,entityAnnotations:{},_item:null},a.merge(c,b)},b.build=function(c,d){return b.create({id:a.get("@id",c,d),text:a.get(""+n+"selected-text",c,d)[G],start:a.get(""+n+"start",c,d),end:a.get(""+n+"end",c,d),confidence:a.get(o,c,d),entityAnnotations:{},_item:c})},b.find=function(a,b,c){var d,e;for(e in a)if(d=a[e],d.start===b&&d.end===c)return d},b.findOrCreate=function(a,c){var d;return d=b.find(a,c.start,c.end),null!=d?d:(d=b.create({text:c.label,start:c.start,end:c.end,confidence:1}),a[d.id]=d,d)},b}]),angular.module("wordlift.tinymce.plugin.services",["wordlift.tinymce.plugin.config","LoggerService","wordlift.tinymce.plugin.services.EditorService","wordlift.tinymce.plugin.services.EntityService","wordlift.tinymce.plugin.services.EntityAnnotationService","wordlift.tinymce.plugin.services.EntityAnnotationConfidenceService","wordlift.tinymce.plugin.services.TextAnnotationService","wordlift.tinymce.plugin.services.Helpers","AnalysisService"]),angular.module("wordlift.tinymce.plugin.controllers",["wordlift.tinymce.plugin.config","wordlift.tinymce.plugin.services"]).filter("orderObjectBy",function(){return function(a,b,c){var d;return d=[],angular.forEach(a,function(a){return d.push(a)}),d.sort(function(a,c){return a[b]>c[b]}),c&&d.reverse(),d}}).filter("filterObjectBy",function(){return function(a,b,c){var d;return d=[],angular.forEach(a,function(a){return a[b]===c?d.push(a):void 0}),d}}).controller("EntitiesController",["AnalysisService","EntityAnnotationService","EditorService","$http","$log","$scope","$rootScope",function(b,c,d,e,f,g){var h,i,j;return g.isRunning=!1,g.analysis=b.createAnEmptyAnalysis(),g.textAnnotation=null,g.textAnnotationSpan=null,g.newEntity={label:null,type:null},g.activeToolbarTab="Add new entity",g.isActiveToolbarTab=function(a){return g.activeToolbarTab===a},g.setActiveToolbarTab=function(a){return g.activeToolbarTab!==a?(g.autocompleteOpened=!1,g.activeToolbarTab=a):void 0},g.autocompleteOpened=!1,g.knownTypes=null,j=function(b){return a("head").append("<style>#wordlift-disambiguation-popover .postbox:before,#wordlift-disambiguation-popover .postbox:after{top:"+b+"px;}</style>")},h=void 0,i=function(){var a;if(null!=h)return a=d.getWinPos(h),j(a.top-50)},a(window).scroll(i),a("#content_ifr").contents().scroll(i),g.onSearch=function(a){return e({method:"post",url:ajaxurl+"?action=wordlift_search",data:{term:a}}).then(function(a){return a.data.map(function(a){return c.create({entity:a})})})},g.onNewEntityCreate=function(){return g.isRunning=!0,e({method:"post",url:ajaxurl+"?action=wordlift_add_entity",data:g.newEntity}).success(function(a){var d;return g.isRunning=!1,d=c.create({entity:a}),b.enhance(g.analysis,g.textAnnotation,d)===!0?g.$emit("selectEntity",{ta:g.textAnnotation,ea:d}):void 0}).error(function(){return g.isRunning=!1,f.debug("Got en error on onNewEntityCreate")})},g.onSearchedEntitySelected=function(a){return b.enhance(g.analysis,g.textAnnotation,a)===!0?g.$emit("selectEntity",{ta:g.textAnnotation,ea:a}):void 0},g.onEntitySelected=function(a,b){return g.$emit("selectEntity",{ta:a,ea:b})},g.$on("analysisReceived",function(a,b){return g.analysis=b}),g.$on("autocompleteOpened",function(){return g.autocompleteOpened=!0}),g.$on("autocompleteClosed",function(){return g.autocompleteOpened=!1}),g.$on("configurationTypesLoaded",function(a,b){return g.knownTypes=b}),g.$on("textAnnotationAdded",function(a,c){return b.addTextAnnotation(g.analysis,c),g.$broadcast("textAnnotationClicked",c.id)}),g.$on("textAnnotationClicked",function(b,c){var e,f,h,i;return g.textAnnotation=null!=(f=g.analysis)?f.textAnnotations[c]:void 0,g.newEntity.label=null!=(h=g.textAnnotation)?h.text:void 0,null==(null!=(i=g.textAnnotation)?i.entityAnnotations:void 0)?a("#wordlift-disambiguation-popover").hide():(e=d.getWinPos(c),j(e.top-50),a("#wordlift-disambiguation-popover").show())})}]).controller("ErrorController",["$element","$scope","$log",function(b,c){var d;return d=a(b).dialog({title:"WordLift",dialogClass:"wp-dialog",modal:!0,autoOpen:!1,closeOnEscape:!0,buttons:{Ok:function(){return a(this).dialog("close")}}}),c.$on("error",function(a,b){return c.message=b,d.dialog("open")})}]),a=jQuery,angular.module("wordlift.tinymce.plugin",["wordlift.tinymce.plugin.controllers","wordlift.tinymce.plugin.directives"]),a(J=a('<div id="wl-app" class="wl-app">\n  <div id="wl-error-controller" class="wl-error-controller" ng-controller="ErrorController">\n    <p ng-bind="message"></p>\n  </div>\n  <div id="wordlift-disambiguation-popover" class="metabox-holder" ng-controller="EntitiesController">\n    <div class="postbox">\n      <div class="handlediv" title="Click to toggle"><br></div>\n      <h3 class="hndle"><span>Entity Reconciliation</span></h3>\n      <div class="ui-widget toolbar">\n        <span class="wl-active-tab" ng-bind="activeToolbarTab" />\n        <i ng-class="{\'selected\' : isActiveToolbarTab(\'Search for entities\')}" ng-click="setActiveToolbarTab(\'Search for entities\')" class="wl-search-toolbar-icon" />\n        <i ng-class="{\'selected\' : isActiveToolbarTab(\'Add new entity\')}" ng-click="setActiveToolbarTab(\'Add new entity\')" class="wl-add-entity-toolbar-icon" />\n      </div>\n      <div class="inside">\n        <form role="form">\n          <div class="form-group">\n            <div ng-show="isActiveToolbarTab(\'Search for entities\')" class="tab">\n              <div class="ui-widget">\n                <input type="text" class="form-control" id="search" placeholder="search for entities" autocomplete on-select="onSearchedEntitySelected(entityAnnotation)" source="onSearch($viewValue)">\n              </div>       \n            </div>\n            <div ng-show="isActiveToolbarTab(\'Add new entity\')" class="tab">\n              <div class="ui-widget">\n                <input ng-model="newEntity.label" type="text" class="form-control" id="label" placeholder="label">\n              </div>\n              <div class="ui-widget">\n                <select ng-model="newEntity.type" ng-options="type.uri as type.label for type in knownTypes" placeholder="type">\n                  <option value="" disabled selected>Select the entity type</option>\n                </select>\n              </div>\n              <div class="ui-widget button-container">\n                <i class="wl-spinner" ng-show="isRunning"></i>\n                <button ng-click="onNewEntityCreate(newEntity)">Save Entity</button>\n              </div>\n            </div>\n          </div>\n          <div id="wl-entities-wrapper" ng-hide="autocompleteOpened">\n            <wl-entities on-select="onEntitySelected(textAnnotation, entityAnnotation)" text-annotation="textAnnotation"></wl-entities>\n          </div>\n        </form>\n        \n        <wl-entity-input-boxes text-annotations="analysis.textAnnotations"></wl-entity-input-boxes>\n        <wl-entity-props text-annotations="analysis.textAnnotations"></wl-entity-props>\n      </div>\n    </div>\n  </div>\n</div>').appendTo("form[name=post]"),a("#wordlift-disambiguation-popover").css({display:"none",height:a("body").height()-a("#wpadminbar").height()+12,top:a("#wpadminbar").height()-1,right:20}).draggable(),a("#wordlift-disambiguation-popover .handlediv").click(function(){return a("#wordlift-disambiguation-popover").hide()}),K=angular.bootstrap(a("#wl-app"),["wordlift.tinymce.plugin"]),K.invoke(["AnalysisService","EntityAnnotationConfidenceService",function(a,b){return null!=window.wordlift?(a.setKnownTypes(window.wordlift.types),a.setEntities(window.wordlift.entities),b.setEntities(window.wordlift.entities)):void 0}]),tinymce.PluginManager.add("wordlift",function(a){return a.onLoadContent.add(function(){return K.invoke(["EditorService",function(a){return a.createDefaultAnalysis()}])}),a.addButton("wordlift_add_entity",{classes:"widget btn wordlift_add_entity",text:" ",tooltip:"Insert entity",onclick:function(){return K.invoke(["EditorService","$rootScope",function(a,b){return b.$apply(function(){return a.createTextAnnotationFromCurrentSelection()})}])}}),a.addButton("wordlift",{classes:"widget btn wordlift",text:" ",tooltip:"Analyse",onclick:function(){return K.invoke(["EditorService","$rootScope","$log",function(b,c){return c.$apply(function(){var c,d;return c=a.getContent({format:"raw"}),d=F.create(c).getText(),b.analyze(d)})}])}}),a.onClick.add(function(a,b){return K.invoke(["$rootScope",function(a){return a.$apply(function(){return a.$broadcast("textAnnotationClicked",b.target.id)})}])})})),b=a("#wl-entity-display-as-select"),b.siblings("a.wl-edit-entity-display-as").click(function(c){return b.is(":hidden")&&(b.slideDown("fast").find("select").focus(),a(this).hide()),c.preventDefault()}),b.find(".wl-save-entity-display-as").click(function(c){return b.slideUp("fast").siblings("a.wl-edit-entity-display-as").show(),a("#hidden_wl_entity_display_as").val(a("#wl_entity_display_as").val()),a("#wl-entity-display-as").html(a("#wl_entity_display_as option:selected").text()),c.preventDefault()}),b.find(".wl-cancel-entity-display-as").click(function(b){return a("#wl-entity-display-as-select").slideUp("fast").siblings("a.wl-edit-entity-display-as").show().focus(),a("#wl_entity_display_as").val(a("#hidden_wl_entity_display_as").val()),b.preventDefault()}),jQuery(function(a){a("body").append('<div id="wordlift_chord_dialog">\n<form>\n<p>    \n  <input value="2" id="wordlift_chord_depth_field" readonly size="3"> \n  Depth: Max degree of separtation between entities.\n</p>\n<div id="wordlift_chord_depth_slider"></div>\n<p>\n  Base to generate the color palette of the Graph.<br />\n  <input type="text" value="#22f" id="wordlift_chord_color_field" size="4">\n</p>\n<p>\n  <input value="500" id="wordlift_chord_width_field" size="4">\n  Width of the Graph in pixels\n</p>\n<p>\n  <input value="520" id="wordlift_chord_height_field" size="4">\n  Height of the Graph in pixels.\n</p>\n<p>\n  <input id="wordlift_chord_dialog_ok" type="button" value="Ok" width="100">\n</p>\n</form>\n</div>'),a("#wordlift_chord_color_field").wpColorPicker({hide:!0}),a("#wordlift_chord_depth_slider").slider({range:"max",min:1,max:5,value:2,slide:function(b,c){a("#wordlift_chord_depth_field").val(c.value)}}),a("#wordlift_chord_dialog").hide(),a("#wordlift_chord_dialog_ok").on("click",function(){var b,c,d,e,f;
f=a("#wordlift_chord_width_field").val(),c=a("#wordlift_chord_height_field").val(),d=a("#wordlift_chord_color_field").val(),b=a("#wordlift_chord_depth_field").val(),e="[wl-chord width="+f+"px height= "+c+"px main_color="+d+" depth="+b+"]",top.tinymce.activeEditor.execCommand("mceInsertContent",!1,e),a("#wordlift_chord_dialog").dialog("close")})})}).call(this);
//# sourceMappingURL=wordlift.min.map