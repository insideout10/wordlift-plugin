var $,container,injector,indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("wordlift.ui.carousel",["ngTouch"]).directive("wlCarousel",["$window","$log",function(o,e){return{restrict:"A",scope:!0,transclude:!0,template:'<div class="wl-carousel" ng-class="{ \'active\' : areControlsVisible }" ng-show="panes.length > 0" ng-mouseover="showControls()" ng-mouseleave="hideControls()">\n  <div class="wl-panes" ng-style="{ width: panesWidth, left: position }" ng-transclude ng-swipe-left="next()" ng-swipe-right="prev()" ></div>\n  <div class="wl-carousel-arrows" ng-show="areControlsVisible" ng-class="{ \'active\' : isActive() }">\n    <i class="wl-angle left" ng-click="prev()" ng-show="isPrevArrowVisible()" />\n    <i class="wl-angle right" ng-click="next()" ng-show="isNextArrowVisible()" />\n  </div>\n</div>',controller:["$scope","$element","$attrs","$log",function(s,e,t,n){var i,r;return r=angular.element(o),s.setItemWidth=function(){return e.width()/s.visibleElements()},s.showControls=function(){return s.areControlsVisible=!0},s.hideControls=function(){return s.areControlsVisible=!1},s.visibleElements=function(){return 460<e.width()?4:1},s.isActive=function(){return s.isPrevArrowVisible()||s.isNextArrowVisible()},s.isPrevArrowVisible=function(){return 0<s.currentPaneIndex},s.isNextArrowVisible=function(){return s.panes.length-s.currentPaneIndex>s.visibleElements()},s.next=function(){if(!(s.currentPaneIndex+s.visibleElements()+1>s.panes.length))return s.position=s.position-s.itemWidth,s.currentPaneIndex=s.currentPaneIndex+1},s.prev=function(){if(0!==s.currentPaneIndex)return s.position=s.position+s.itemWidth,s.currentPaneIndex=s.currentPaneIndex-1},s.setPanesWrapperWidth=function(){return s.panesWidth=s.panes.length*s.itemWidth,s.position=0,s.currentPaneIndex=0},s.itemWidth=s.setItemWidth(),s.panesWidth=void 0,s.panes=[],s.position=0,s.currentPaneIndex=0,s.areControlsVisible=!1,i=function(){var e,t,n;for(s.itemWidth=s.setItemWidth(),s.setPanesWrapperWidth(),e=0,t=(n=s.panes).length;e<t;e++)n[e].scope.setWidth(s.itemWidth);return s.$apply()},r.bind("resize",function(){return i}),r.bind("load",function(){return i}),this.registerPane=function(e,t,n){var i;return e.setWidth(s.itemWidth),i={scope:e,element:t},s.panes.push(i),s.setPanesWrapperWidth()},this.unregisterPane=function(e){var t,n,i,r,o;for(o=void 0,n=t=0,i=(r=s.panes).length;t<i;n=++t)r[n].scope.$id===e.$id&&(o=n);return s.panes.splice(o,1),s.setPanesWrapperWidth()}}]}}]).directive("wlCarouselPane",["$log",function(r){return{require:"^wlCarousel",restrict:"EA",scope:{wlFirstPane:"="},transclude:!0,template:"<div ng-transclude></div>",link:function(e,t,n,i){return t.addClass("wl-carousel-item"),e.isFirst=e.wlFirstPane||!1,e.setWidth=function(e){return t.css("width",e+"px")},e.$on("$destroy",function(){return r.debug("Destroy "+e.$id),i.unregisterPane(e)}),i.registerPane(e,t,e.isFirst)}}}]),angular.module("wordlift.utils.directives",[]).directive("wlOnError",["$parse","$window","$log",function(r,e,t){return{restrict:"A",compile:function(e,t){return function(n,e){var i;return i=r(t.wlOnError),e.on("error",function(e){var t;return t=function(){return i(n,{$event:e})},n.$apply(t)})}}}}]).directive("wlFallback",["$window","$log",function(e,r){return{restrict:"A",priority:99,link:function(e,t,n,i){return t.bind("error",function(){if(n.src!==n.wlFallback)return r.warn("Error on "+n.src+"! Going to fallback on "+n.wlFallback),n.$set("src",n.wlFallback)})}}}]).directive("wlHideAfter",["$timeout","$log",function(o,s){return{restrict:"A",link:function(e,t,n,i){var r;return r=+n.wlHideAfter,o(function(){return s.debug("Remove msg after "+r+" ms"),t.hide()},r)}}}]).directive("wlClipboard",["$timeout","$document","$log",function(r,o,s){return{restrict:"E",scope:{text:"=",onCopied:"&"},transclude:!0,template:'<span\n  class="wl-widget-post-link"\n  ng-class="{\'wl-widget-post-link-copied\' : $copied}"\n  ng-click="copyToClipboard()">\n  <ng-transclude></ng-transclude>\n  <input type="text" ng-value="text" />\n</span>',link:function(t,e,n,i){return t.$copied=!1,t.node=e.find("input"),t.node.css("position","absolute"),t.node.css("left","-10000px"),t.copyToClipboard=function(){var e;try{if(o[0].body.style.webkitUserSelect="initial",(e=o[0].getSelection()).removeAllRanges(),t.node.select(),o[0].execCommand("copy")||s.warn("Error on clipboard copy for "+text),e.removeAllRanges(),t.$copied=!0,r(function(){return s.debug("Going to reset $copied status"),t.$copied=!1},3e3),angular.isFunction(t.onCopied))return t.$evalAsync(t.onCopied())}finally{o[0].body.style.webkitUserSelect=""}}}}}]),$=jQuery,angular.module("wordlift.facetedsearch.widget",["wordlift.ui.carousel","wordlift.utils.directives"]).provider("configuration",function(){var t;return t=void 0,{setConfiguration:function(e){return t=e},$get:function(){return t}}}).filter("filterEntitiesByType",["$log","configuration",function(e,t){return function(e,t){var n,i,r,o;for(r in i=[],e)o=(n=e[r]).mainType,0<=indexOf.call(t,o)&&i.push(n);return i}}]).directive("wlFacetedPosts",["configuration","$window","$log",function(a,e,t){return{restrict:"E",scope:!0,template:function(e,t){var n,i,r,o,s;return s="wl-wrapper",o=" wl-carousel",i="wl-post wl-card wl-item-wrapper",n=" wl-carousel-pane",r="wl-card-image",a.attrs.with_carousel||(s="wl-floating-wrapper",i="wl-post wl-card wl-floating-item-wrapper",n=o=""),a.attrs.squared_thumbs&&(r="wl-card-image wl-square"),'<div class="wl-posts">\n  <div class="'+s+'" '+o+'>\n    <div class="'+i+'" ng-repeat="post in posts"'+n+'>\n      <div class="'+r+'">\n        <a ng-href="{{post.permalink}}" style="background: url(\'{{post.thumbnail}}\') no-repeat center center; background-size: cover;"></a>\n      </div>\n      <div class="wl-card-title">\n        <a ng-href="{{post.permalink}}">{{post.post_title}}</a>\n      </div>\n    </div>\n  </div>\n</div>'}}}]).controller("FacetedSearchWidgetController",["DataRetrieverService","configuration","$scope","filterEntitiesByTypeFilter","$log",function(t,n,s,a,i){return s.entity=void 0,s.posts=[],s.facets=[],s.conditions={},s.entityLimit=5,s.supportedTypes=[{scope:"what",types:["thing","creative-work","recipe"]},{scope:"who",types:["person","organization","local-business"]},{scope:"where",types:["place"]},{scope:"when",types:["event"]}],s.configuration=n,s.filteringEnabled=!0,s.toggleFacets=function(){return s.configuration.attrs.show_facets=!s.configuration.attrs.show_facets,s.conditions={},t.load("posts")},s.isInConditions=function(e){return 0===Object.keys(s.conditions).length||!!s.conditions[e.id]},s.addCondition=function(e){return i.debug("Add entity "+e.id+" to conditions array"),s.conditions[e.id]?delete s.conditions[e.id]:s.conditions[e.id]=e,t.load("posts",Object.keys(s.conditions))},s.$on("postsLoaded",function(e,t){return i.debug("Referencing posts for item "+n.post_id+" ..."),s.posts=t}),s.$on("facetsLoaded",function(e,t){return i.debug("Referencing facets for item "+n.post_id+" ..."),s.facets=t}),s.$watch("facets",function(e){var t,n,i,r,o;for(r=[],t=0,n=(i=s.supportedTypes).length;t<n;t++)o=i[t],r.push(o.entities=a(e,o.types));return r})}]).service("DataRetrieverService",["configuration","$log","$http","$rootScope",function(i,r,o,s){return{load:function(n,e){var t;return null==e&&(e=[]),t=i.ajax_url+"?action="+i.action+"&post_id="+i.post_id+"&limit="+i.limit+"&type="+n,r.debug("Going to search "+n+" with conditions"),o({method:"post",url:t,data:e}).success(function(e){return s.$broadcast(n+"Loaded",e)}).error(function(e,t){return r.warn("Error loading "+n+", statut "+t)})}}}]).config(["configurationProvider",function(e){return e.setConfiguration(window.wl_faceted_search_params)}]),$(container=$('<div ng-controller="FacetedSearchWidgetController" ng-show="posts.length > 0">\n      <h4 class="wl-headline">\n        {{configuration.attrs.title}}\n        <i class="wl-toggle-on" ng-hide="configuration.attrs.show_facets" ng-click="toggleFacets()"></i>\n        <i class="wl-toggle-off" ng-show="configuration.attrs.show_facets" ng-click="toggleFacets()"></i>\n      </h4>\n      <div ng-show="configuration.attrs.show_facets" class="wl-facets" ng-show="filteringEnabled">\n        <div class="wl-facets-container" ng-repeat="box in supportedTypes" ng-hide="0 === box.entities.length">\n          <h5>{{configuration.l10n[box.scope]}}</h5>\n          <ul>\n            <li class="entity" ng-repeat="entity in box.entities | orderBy:[ \'-counter\', \'-createdAt\' ] | limitTo:entityLimit" ng-click="addCondition(entity)">\n                <span class="wl-label" ng-class=" { \'selected\' : isInConditions(entity) }">\n                  {{entity.label}}\n                </span>\n            </li>\n          </ul>\n        </div>\n      </div>\n      <wl-faceted-posts></wl-faceted-posts>\n\n    </div>').appendTo("#wordlift-faceted-entity-search-widget"),injector=angular.bootstrap($("#wordlift-faceted-entity-search-widget"),["wordlift.facetedsearch.widget"]),injector.invoke(["DataRetrieverService","$rootScope","$log",function(e,t,n){return t.$apply(function(){return e.load("posts"),e.load("facets")})}]));