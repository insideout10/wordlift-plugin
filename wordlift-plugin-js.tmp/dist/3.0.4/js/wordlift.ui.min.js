(function(){var a;a=jQuery,a.fn.extend({chord:function(b){var c,d,e,f,g,h;return h={dataEndpoint:void 0,mainColor:"#777",depth:2,maxLabelLength:30,maxWordLength:5,debug:!1},h=a.extend(h,b),d=a(this),g=function(){return a.ajax({type:"GET",url:h.dataEndpoint,data:{depth:h.depth},success:function(a){return c(a)}})},c=function(a){var b,c,e,g,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;if(null==a.entities||a.entities.length<2)return d.hide(),void f("No data found for the chord.");for(v=function(a,b,c){return"translate("+a*c+","+b*c+")"},r=function(a){return"rotate("+a+")"},p=function(a){return a/(2*Math.PI)*360},s=function(a){return a>=0?1:-1},c=function(a){var b,c,d,e;for(a.length>h.maxLabelLength&&(a=a.substring(0,h.maxLabelLength)+"..."),a=a.split(/\s/),b=[],c=d=0,e=a.length-1;e>=0?e>=d:d>=e;c=e>=0?++d:--d)a[c].length>h.maxWordLength||c===a.length-1?b.push(a[c]):a[c+1]=a[c]+" "+a[c+1];return b},g=function(a,b){var c,d,e,f;for(a=String(a).replace(/[^0-9a-f]/gi,""),a.length<6&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),b=b||0,e="#",c=void 0,d=void 0,d=f=0;3>=f;d=++f)c=parseInt(a.substr(2*d,2),16),c=Math.round(Math.min(Math.max(0,c+c*b),255)).toString(16),e+=("00"+c).substr(c.length);return e},k=function(b){var c,d,e;for(c=d=0,e=a.entities.length;e>=0?e>=d:d>=e;c=e>=0?++d:--d)if(a.entities[c].uri===b)return c;return-1},n=[],E=a.entities,A=0,C=E.length;C>A;A++)j=E[A],n.push(function(){var b,c,d,e;for(d=a.entities,e=[],b=0,c=d.length;c>b;b++)i=d[b],e.push(0);return e}());for(F=a.relations,B=0,D=F.length;D>B;B++)q=F[B],y=k(q.s),z=k(q.o),n[y][z]=1,n[z][y]=1;return w=d3.select("#"+d.attr("id")).append("svg"),w.attr("width","100%").attr("height","100%"),x=parseInt(w.style("width")),l=parseInt(w.style("height")),t=x>l?l:x,m=.2*t,o=.25*t,b=d3.svg.arc().innerRadius(m).outerRadius(o),e=d3.layout.chord().padding(.3).matrix(n),w.selectAll("chords").data(e.chords).enter().append("path").attr("class","relation").attr("d",d3.svg.chord().radius(m)).attr("transform",v(.5,.5,t)).style("opacity",.2).on("mouseover",function(){return d3.select(this).style("opacity",.8)}).on("mouseout",function(){return d3.select(this).style("opacity",.2)}),w.selectAll("arcs").data(e.groups).enter().append("path").attr("class",function(b){return"entity "+a.entities[b.index].css_class}).attr("d",b).attr("transform",v(.5,.5,t)).style("fill",function(b){var c,d;return c=h.mainColor,d=a.entities[b.index].type,"post"===d?c:"entity"===d?g(c,-.5):g(c,.5)}),w.selectAll("arcs_labels").data(e.groups).enter().append("text").attr("class","label").attr("font-size",function(){var a;return a=parseInt(t/35),8>a&&(a=8),a+"px"}).each(function(b){var d,e,f,g,h;for(e=c(a.entities[b.index].label),f=d3.select(this).attr("dy",e.length/3-.9*(e.length-1)+"em").html(e[0]),d=g=1,h=e.length;h>=1?h>=g:g>=h;d=h>=1?++g:--g)f.append("tspan").attr("x",0).attr("dy","1em").html(e[d]);return f.attr("transform",function(a){var b,c,d,e;return b=a.startAngle-Math.PI/2+Math.abs((a.endAngle-a.startAngle)/2),d=3,c=void 0,b>Math.PI/2?(c=b-Math.PI,d+=d3.select(this)[0][0].clientWidth):c=b,c=p(c),e=(o+d)/t,y=.5+e*Math.cos(b),z=.5+e*Math.sin(b),v(y,z,t)+r(c)})}),u=d3.select("body").append("div").attr("class","tooltip").style("background-color","white").style("opacity",0).style("position","absolute").style("z-index",100),w.selectAll(".entity, .label").on("mouseover",function(b){return d3.select(this).attr("cursor","pointer"),w.selectAll(".relation").filter(function(a){return a.source.index===b.index||a.target.index===b.index}).style("opacity",.8),u.text(a.entities[b.index].label).style("opacity",1)}).on("mouseout",function(a){return w.selectAll(".relation").filter(function(b){return b.source.index===a.index||b.target.index===a.index}).style("opacity",.2),u.style("opacity",0)}).on("mousemove",function(){return u.style("left",d3.event.pageX+"px").style("top",d3.event.pageY-30+"px")}).on("click",function(b){var c;return c=a.entities[b.index].url,window.location=c})},e=function(){return g()},f=function(a){return h.debug&&"undefined"!=typeof console&&null!==console?console.log(a):void 0},e()}}),jQuery(function(a){return a(".wl-chord").each(function(){var b,c,d;return b=a(this),c=b.data(),a.extend(c,wl_chord_params),d=""+c.ajax_url+"?"+a.param({action:c.action,post_id:c.postId}),b.chord({dataEndpoint:d,depth:c.depth,mainColor:c.mainColor})})}),a=jQuery,a.fn.extend({timeline:function(b){var c,d,e,f,g,h;return h={dataEndpoint:void 0,width:"100%",height:"600",debug:!1},h=a.extend(h,b),d=a(this),g=function(){return a.ajax({type:"GET",url:h.dataEndpoint,success:function(a){return c(a)}})},c=function(a){return null!=a.timeline?createStoryJS({type:"timeline",width:h.width,height:h.height,source:a,embed_id:d.attr("id"),start_at_slide:a.startAtSlide}):(d.hide(),void f("Timeline data missing: timeline cannot be rendered"))},e=function(){return g()},f=function(a){return h.debug&&"undefined"!=typeof console&&null!==console?console.log(a):void 0},e()}}),jQuery(function(a){return a(".wl-timeline").each(function(){var b,c,d;return b=a(this),c=b.data(),a.extend(c,wl_timeline_params),d=""+c.ajax_url+"?"+a.param({action:c.action,post_id:c.postId}),a(this).timeline({dataEndpoint:d})})}),a=jQuery,a.fn.extend({geomap:function(b){var c,d,e,f,g,h;return h={dataEndpoint:void 0,zoom:13,debug:!1},h=a.extend(h,b),d=a(this),e=function(){return g()},g=function(){return a.ajax({type:"GET",url:h.dataEndpoint,success:function(a){return c(a)}})},c=function(a){var b,c,e;return null==a.features||0===(null!=(c=a.features)?c.length:void 0)?(d.hide(),void f("Features missing: geomap cannot be rendered")):(b=L.map(d.attr("id")),1===(null!=(e=a.boundaries)?e.length:void 0)?b.setView(a.boundaries[0],h.zoom):b.fitBounds(L.latLngBounds(a.boundaries)),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(b),L.geoJson(a.features,{pointToLayer:function(a,b){return L.marker(b,{})},onEachFeature:function(a,b){var c;return(null!=(c=a.properties)?c.popupContent:void 0)?b.bindPopup(a.properties.popupContent):void 0}}).addTo(b))},f=function(a){return h.debug&&"undefined"!=typeof console&&null!==console?console.log(a):void 0},e()}}),jQuery(function(a){return a(".wl-geomap").each(function(){var b,c,d;return b=a(this),c=b.data(),a.extend(c,wl_geomap_params),d=""+c.ajax_url+"?"+a.param({action:c.action,post_id:c.postId}),b.geomap({dataEndpoint:d})})})}).call(this);
//# sourceMappingURL=wordlift.ui.min.map